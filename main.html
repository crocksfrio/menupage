<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Forçar modo claro e tentar prevenir inversão de cores -->
    <meta name="color-scheme" content="light only">
    <meta name="theme-color" content="#f8f9fa">
    <title>Crocks Frio - Menu Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Importar Dados Externos -->
    <script src="main/menu-data.js"></script>

    <style>
        /* RESET PARA TV - EVITAR MODO NOTURNO */
        html, body {
            background-color: #f8f9fa !important;
            color: #1f2937 !important;
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            /* Tenta anular filtros de modo noturno agressivos de algumas TVs */
            filter: brightness(1) contrast(1) !important;
        }

        :root {
            color-scheme: light !important;
        }

        .font-display { font-family: 'Fredoka', sans-serif; }
        
        /* ANIMAÇÃO SIMPLIFICADA (Mais leve para a CPU da TV) */
        .slide-fade {
            animation: fadeIn 0.6s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* PREÇOS SEM QUEBRA */
        .price-tag {
            background: linear-gradient(135deg, #2dd4bf 0%, #0f766e 100%) !important;
            color: white !important;
            padding: 4px 12px;
            border-radius: 50px;
            font-weight: 800;
            white-space: nowrap !important;
            display: inline-block;
        }

        /* IMAGENS DE MÍDIA - Sem Ken Burns para não travar */
        .media-container img {
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            position: absolute;
            top: 0; 
            left: 0;
            opacity: 0; 
            transition: opacity 1s ease-in-out;
        }
        .media-container img.active { opacity: 1; }

        /* Estilo para garantir que o fundo do Petit Gateau não suma */
        .pg-card {
            background-color: #78350f !important;
            background-size: cover !important;
            background-position: center !important;
        }

        .text-shadow { text-shadow: 2px 2px 4px rgba(0,0,0,0.6); }

        /* Ajuste de escala para 32" (HD/FHD) */
        @media (min-width: 1200px) {
            .container-main { font-size: 1.1rem; }
            h2 { font-size: 2.5rem !important; }
        }
    </style>
</head>
<body class="flex bg-gray-50 overflow-hidden">

    <!-- LADO ESQUERDO: MÍDIA (40%) -->
    <div class="w-[40%] h-full relative bg-black overflow-hidden shadow-2xl z-10 media-container" id="media-container">
        <!-- Overlay para garantir leitura do rodapé da imagem -->
        <div class="absolute bottom-0 left-0 w-full h-1/4 bg-gradient-to-t from-black/90 to-transparent z-20"></div>
        <div class="absolute bottom-8 left-8 z-30 text-white">
            <h2 class="text-3xl font-display font-bold text-teal-400 mb-1 text-shadow">Crocks Frio</h2>
            <p class="text-lg opacity-90 text-shadow">Gelados Artesanais & Café</p>
        </div>
    </div>

    <!-- LADO DIREITO: CARDÁPIO (60%) -->
    <div class="w-[60%] h-full flex flex-col relative bg-white">
        <!-- Padrão de fundo leve -->
        <div class="absolute inset-0 opacity-5 pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
        
        <!-- Cabeçalho Fixo -->
        <div class="h-[10vh] flex items-center justify-between px-8 border-b border-gray-100 bg-white/95 z-20">
            <div class="flex items-center gap-3">
                <i class="fas fa-ice-cream text-3xl text-teal-500"></i>
                <h1 class="text-2xl font-display font-bold text-gray-800 uppercase tracking-wide">Menu</h1>
            </div>
            <div class="text-teal-600 font-bold text-lg flex items-center gap-2">
                <i class="fab fa-instagram"></i> @crocksfrio.oficial
            </div>
        </div>

        <!-- Conteúdo Dinâmico -->
        <div class="flex-1 p-8 relative z-10" id="menu-content">
            <div class="flex items-center justify-center h-full text-gray-400 font-display italic animate-pulse">
                Iniciando sistema...
            </div>
        </div>

        <!-- Barra de Progresso (Rodapé) -->
        <div class="h-1.5 w-full bg-gray-100 absolute bottom-0 left-0 z-30">
            <div id="progress-bar" class="h-full bg-teal-500 w-0 transition-all duration-[linear]"></div>
        </div>
    </div>

    <script>
        const SLIDE_DURATION = 15000;

        // Fallback básico para evitar erros fatais
        const DEFAULT_DATA = {
            sorvetes: { titulo: "Sorvetes", itens: [], servicos: [] },
            cafeteria: { titulo: "Cafeteria", itens: [] },
            salgados: { titulo: "Salgados", itens: [], destaques: [] },
            doces: { titulo: "Doces", milkshake: {}, petit_gateau: {}, outros: [] }
        };

        function getSafeData() {
            return (typeof MENU_DATA !== 'undefined') ? MENU_DATA : DEFAULT_DATA;
        }

        const contentData = [
            // SLIDE 1: SORVETES
            {
                media: [
                    { src: 'main/icecream_1.jpg', fb: 'https://images.unsplash.com/photo-1563805042-7684c019e1cb' },
                    { src: 'main/icecream_2.jpg', fb: 'https://images.unsplash.com/photo-1501443762994-82bd5dace89a' }
                ],
                getHtml: () => {
                    const d = getSafeData().sorvetes;
                    const items = d.itens.map((item, idx) => {
                        const colors = ['teal', 'orange', 'purple', 'pink'];
                        const color = colors[idx % colors.length];
                        const highlight = item.destaque ? `ring-2 ring-yellow-400 scale-[1.02] bg-yellow-50/30` : `bg-white`;
                        const tag = item.destaque ? `<span class="bg-yellow-400 text-yellow-900 text-[10px] px-2 py-0.5 rounded-full font-black ml-2 uppercase whitespace-nowrap">O mais pedido</span>` : '';
                        
                        return `
                        <div class="${highlight} p-4 rounded-xl shadow-sm border-l-4 border-${color}-500 flex flex-col justify-between h-28">
                            <div class="flex justify-between items-start">
                                <h3 class="text-lg font-black text-gray-800 leading-none uppercase">${item.nome}${tag}</h3>
                            </div>
                            <p class="text-gray-500 text-xs line-clamp-2">${item.desc}</p>
                            <div class="flex justify-end">
                                <span class="price-tag">R$ ${item.preco}</span>
                            </div>
                        </div>`;
                    }).join('');

                    const services = d.servicos.map(s => `
                        <div class="flex flex-col items-center">
                            <div class="w-14 h-14 rounded-full overflow-hidden border-2 border-teal-100 mb-1">
                                <img src="${s.img}" onerror="this.src='https://placehold.co/100x100?text=Foto'" class="w-full h-full object-cover">
                            </div>
                            <span class="text-[10px] font-bold uppercase text-gray-600">${s.nome}</span>
                            <span class="text-xs font-black text-teal-600">${s.preco}</span>
                        </div>
                    `).join('');

                    return `
                    <div class="slide-fade h-full flex flex-col justify-between">
                        <div>
                            <h2 class="font-display font-bold text-teal-600 mb-6 border-l-8 border-teal-500 pl-4 uppercase tracking-tighter">${d.titulo}</h2>
                            <div class="grid grid-cols-2 gap-4">${items}</div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100">
                            <h3 class="text-sm font-bold text-gray-400 uppercase mb-3 text-center tracking-widest">Como quer ser servido?</h3>
                            <div class="grid grid-cols-4 gap-2">${services}</div>
                        </div>
                    </div>`;
                }
            },
            // SLIDE 2: CAFÉ & SALGADOS
            {
                media: [
                    { src: 'main/coffee.jpg', fb: 'https://images.unsplash.com/photo-1497935586351-b67a49e012bf' },
                    { src: 'main/salgado.jpg', fb: 'https://images.unsplash.com/photo-1555507036-ab1f40388085' }
                ],
                getHtml: () => {
                    const data = getSafeData();
                    const cafe = data.cafeteria;
                    const salg = data.salgados;

                    const cafeItems = cafe.itens.map(i => `
                        <div class="flex justify-between items-center bg-white p-2.5 rounded-lg border-b border-gray-100">
                            <div class="leading-tight">
                                <span class="font-bold text-gray-800">${i.nome}</span>
                                <p class="text-[10px] text-gray-400">${i.desc || ''}</p>
                            </div>
                            <span class="font-black text-amber-700 ml-2 whitespace-nowrap">R$ ${i.preco}</span>
                        </div>
                    `).join('');

                    const salgItems = salg.itens.map(i => `
                        <div class="flex justify-between items-center py-1.5 border-b border-dashed border-gray-200">
                            <span class="font-bold text-sm text-gray-700">${i.nome}</span>
                            <span class="font-black text-gray-900 whitespace-nowrap ml-2">R$ ${i.preco}</span>
                        </div>
                    `).join('');

                    return `
                    <div class="slide-fade grid grid-cols-2 gap-8 h-full">
                        <div class="flex flex-col">
                            <h2 class="font-display font-bold text-amber-800 mb-4 border-l-8 border-amber-600 pl-4 uppercase tracking-tighter">${cafe.titulo}</h2>
                            <div class="space-y-1">${cafeItems}</div>
                            <div class="mt-auto bg-green-50 p-2 rounded text-green-700 text-[10px] font-bold text-center border border-green-100">
                                <i class="fas fa-leaf mr-1"></i> ${cafe.extra}
                            </div>
                        </div>
                        <div class="flex flex-col">
                            <h2 class="font-display font-bold text-orange-600 mb-4 border-l-8 border-orange-500 pl-4 uppercase tracking-tighter">${salg.titulo}</h2>
                            <div class="bg-gray-50/50 p-3 rounded-xl mb-4">${salgItems}</div>
                            <div class="space-y-2">
                                ${salg.destaques.map(d => `
                                    <div class="bg-orange-600 text-white p-3 rounded-xl flex justify-between items-center shadow-md">
                                        <span class="font-black text-sm uppercase">${d.nome}</span>
                                        <span class="font-black text-lg">R$ ${d.preco}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>`;
                }
            },
            // SLIDE 3: DOCES
            {
                media: [
                    { src: 'main/dessert_1.jpg', fb: 'https://images.unsplash.com/photo-1572490122747-3968b75cc699' },
                    { src: 'main/dessert_2.jpg', fb: 'https://images.unsplash.com/photo-1606313564200-e75d5e30476d' }
                ],
                getHtml: () => {
                    const doces = getSafeData().doces;
                    const ms = doces.milkshake;
                    const pg = doces.petit_gateau;
                    
                    const pgBg = pg.img_fundo ? `background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('${pg.img_fundo}') !important;` : '';

                    return `
                    <div class="slide-fade h-full flex flex-col">
                        <h2 class="font-display font-bold text-pink-600 mb-6 border-l-8 border-pink-500 pl-4 uppercase tracking-tighter">${doces.titulo}</h2>
                        
                        <div class="grid grid-cols-12 gap-4 mb-4">
                            <div class="col-span-5 bg-pink-50 p-4 rounded-2xl border border-pink-100">
                                <h3 class="text-xl font-black text-pink-800 mb-1 uppercase tracking-tight">${ms.titulo}</h3>
                                <p class="text-[10px] text-pink-400 mb-4 uppercase font-bold">${ms.desc}</p>
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center bg-white p-2 rounded-lg shadow-sm">
                                        <span class="text-xs font-bold text-gray-500 uppercase">${ms.p.tamanho}</span>
                                        <span class="font-black text-pink-600">R$ ${ms.p.preco}</span>
                                    </div>
                                    <div class="flex justify-between items-center bg-white p-2 rounded-lg shadow-sm">
                                        <span class="text-xs font-bold text-gray-500 uppercase">${ms.g.tamanho}</span>
                                        <span class="font-black text-pink-600">R$ ${ms.g.preco}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-span-7 pg-card rounded-2xl p-6 text-white flex flex-col justify-center relative overflow-hidden shadow-lg border-2 border-amber-900" style="${pgBg}">
                                <h3 class="text-3xl font-display font-bold text-shadow uppercase mb-1">${pg.titulo}</h3>
                                <p class="text-amber-200 text-xs text-shadow uppercase mb-4">${pg.desc}</p>
                                <div class="text-right">
                                    <span class="text-4xl font-black text-yellow-400 text-shadow">R$ ${pg.preco}</span>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-3">
                            ${doces.outros.map(g => `
                                <div class="bg-white p-3 rounded-xl shadow-sm border-t-4 border-${g.cor}-400">
                                    <h4 class="font-black text-xs text-gray-700 uppercase mb-1">${g.titulo}</h4>
                                    ${g.itens ? g.itens.map(i => `<div class="flex justify-between text-[10px] mb-0.5"><span>${i.nome}</span><span class="font-bold">R$ ${i.preco}</span></div>`).join('') : `<div class="text-right font-black text-lg text-${g.cor}-600">R$ ${g.preco}</div>`}
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
                }
            }
        ];

        let slideIdx = 0;
        let mediaRotation = null;
        const mediaBox = document.getElementById('media-container');
        const menuBox = document.getElementById('menu-content');
        const pBar = document.getElementById('progress-bar');

        function rotateMedia(list) {
            if (mediaRotation) clearInterval(mediaRotation);
            if (!list || list.length === 0) return;

            const timePerImg = SLIDE_DURATION / list.length;
            let imgIdx = 0;

            const nextImg = () => {
                const item = list[imgIdx];
                const img = document.createElement('img');
                img.src = item.src;
                img.onerror = () => { img.src = item.fb; };
                
                // Limpeza agressiva para economizar RAM da TV
                const currentImgs = mediaBox.querySelectorAll('img');
                currentImgs.forEach(i => {
                    if (!i.classList.contains('active')) i.remove();
                });

                mediaBox.prepend(img);
                
                // Timeout curto para permitir renderização antes do fade
                setTimeout(() => {
                    img.classList.add('active');
                    if (currentImgs[0]) currentImgs[0].style.opacity = '0';
                }, 100);

                imgIdx = (imgIdx + 1) % list.length;
            };

            nextImg();
            if (list.length > 1) mediaRotation = setInterval(nextImg, timePerImg);
        }

        function runSlide() {
            const data = contentData[slideIdx];
            menuBox.innerHTML = data.getHtml();

            pBar.style.transition = 'none';
            pBar.style.width = '0%';
            
            setTimeout(() => {
                pBar.style.transition = `width ${SLIDE_DURATION}ms linear`;
                pBar.style.width = '100%';
            }, 100);

            rotateMedia(data.media);
            slideIdx = (slideIdx + 1) % contentData.length;
        }

        window.onload = () => {
            setTimeout(runSlide, 1000); // Aguarda carregar scripts externos
            setInterval(runSlide, SLIDE_DURATION);
        };
    </script>
</body>
</html>